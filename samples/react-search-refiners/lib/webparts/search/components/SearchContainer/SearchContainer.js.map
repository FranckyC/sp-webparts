{"version":3,"sources":["webparts/search/components/SearchContainer/SearchContainer.tsx"],"names":[],"mappings":"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","file":"webparts/search/components/SearchContainer/SearchContainer.js","sourcesContent":["import * as React from \"react\";\r\nimport ISearchContainerProps from \"./ISearchContainerProps\";\r\nimport ISearchContainerState from \"./ISearchContainerState\";\r\nimport { MessageBar, MessageBarType } from \"office-ui-fabric-react/lib/MessageBar\";\r\nimport { Spinner, SpinnerSize } from \"office-ui-fabric-react/lib/Spinner\";\r\nimport { Logger, LogLevel } from \"sp-pnp-js\";\r\nimport * as strings from \"SearchWebPartStrings\";\r\nimport { ISearchResults, IRefinementFilter } from \"../../../models/ISearchResult\";\r\nimport TilesList from \"../TilesList/TilesList\";\r\nimport \"../SearchWebPart.scss\";\r\nimport FilterPanel from \"../FilterPanel/FilterPanel\";\r\nimport Paging from \"../Paging/Paging\";\r\nimport { Overlay } from \"office-ui-fabric-react\";\r\n\r\nexport default class SearchContainer extends React.Component<ISearchContainerProps,ISearchContainerState> {\r\n\r\n    public constructor(props) {\r\n\r\n        super(props);\r\n\r\n        // Set the initial state\r\n        this.state = {\r\n            results: { \r\n                        RefinementResults: [], \r\n                        RelevantResults: [] \r\n                     },\r\n            selectedFilters: [],\r\n            availableFilters: [],\r\n            currentPage: 1,\r\n            areResultsLoading: false,\r\n            isComponentLoading: true,\r\n            errorMessage: \"\",\r\n            hasError: false,\r\n        };\r\n\r\n        this._onUpdateFilters = this._onUpdateFilters.bind(this);\r\n        this._onPageUpdate = this._onPageUpdate.bind(this);\r\n    }\r\n\r\n    public render(): React.ReactElement<ISearchContainerProps> {\r\n\r\n        const areResultsLoading = this.state.areResultsLoading;\r\n        const items = this.state.results;\r\n        const hasError = this.state.hasError;\r\n        const errorMessage = this.state.errorMessage;\r\n        const isComponentLoading = this.state.isComponentLoading;\r\n\r\n        let wpContent: JSX.Element = null;\r\n        let renderOverlay = null;\r\n        \r\n        if (!isComponentLoading && areResultsLoading) {\r\n                renderOverlay = <div>\r\n                <Overlay isDarkThemed={false} className=\"overlay\">\r\n                </Overlay>\r\n            </div>;\r\n        }\r\n\r\n        if (isComponentLoading) {\r\n            wpContent =  <Spinner size={ SpinnerSize.large } label={ strings.LoadingMessage } />; \r\n        } else {\r\n\r\n            if (hasError) {\r\n                wpContent = <MessageBar messageBarType= { MessageBarType.error }>{ errorMessage }</MessageBar>;\r\n            } else {\r\n\r\n                if (items.RelevantResults.length === 0) {\r\n                    wpContent = \r\n                    <div>\r\n                        <FilterPanel availableFilters={ this.state.availableFilters } onUpdateFilters={ this._onUpdateFilters }/>\r\n                        <div className=\"searchWp__noresult\">{ strings.NoResultMessage }</div>\r\n                    </div>;\r\n                } else {     \r\n                    wpContent = \r\n                      \r\n                          <div>\r\n                              <FilterPanel availableFilters={ this.state.availableFilters } onUpdateFilters={ this._onUpdateFilters }/>\r\n                              { renderOverlay }     \r\n                              <TilesList items={ items.RelevantResults }/>\r\n                              { this.props.showPaging ?\r\n                                <Paging \r\n                                    totalItems={ items.TotalRows }\r\n                                    itemsCountPerPage={ this.props.maxResultsCount } \r\n                                    onPageUpdate={ this._onPageUpdate } \r\n                                    currentPage={ this.state.currentPage }/> \r\n                                : null\r\n                              }\r\n                          </div>;   \r\n                }\r\n            }          \r\n        }\r\n\r\n        return (\r\n            <div className=\"searchWp\">                            \r\n                { wpContent } \r\n            </div>\r\n        );\r\n    }\r\n\r\n    public async componentDidMount() {\r\n\r\n        try {\r\n            \r\n            this.setState({\r\n                areResultsLoading: true,\r\n            });\r\n\r\n            const searchResults = await this.props.searchDataProvider.search(this.props.queryKeywords, this.props.refiners, this.state.selectedFilters, this.state.currentPage);\r\n\r\n            // Initial filters are just set once for the filter control during the component initialization\r\n            // By this way, we are be able to select multiple values whithin a specific filter (OR condition). Otherwise, if we pass every time the new filters retrieved from new results,\r\n            // previous values will overwritten preventing to select multiple values (default SharePoint behavior)\r\n            this.setState({\r\n                results: searchResults,\r\n                availableFilters: searchResults.RefinementResults,\r\n                areResultsLoading: false,\r\n                isComponentLoading: false,\r\n            });\r\n\r\n        } catch (error) {\r\n\r\n            Logger.write(\"[SearchContainer._componentDidMount()]: Error: \" + error, LogLevel.Error);\r\n\r\n            this.setState({\r\n                areResultsLoading: false,\r\n                isComponentLoading: false,\r\n                results: { RefinementResults: [], RelevantResults: [] },\r\n                hasError: true,\r\n                errorMessage: error.message\r\n            });\r\n        }\r\n    }\r\n\r\n    public async componentWillReceiveProps(nextProps: ISearchContainerProps) {\r\n\r\n        // New props are passed to the component when the search query has been changed\r\n        if (this.props.refiners.toString() !== nextProps.refiners.toString()\r\n            || this.props.maxResultsCount  !== nextProps.maxResultsCount) {\r\n\r\n            try {\r\n\r\n                // Clear selected filters on a new query or new refiners\r\n                this.setState({\r\n                    selectedFilters: [],\r\n                    areResultsLoading: true,\r\n                });\r\n\r\n                // We reset the page number and refinement filters\r\n                const searchResults = await this.props.searchDataProvider.search(nextProps.queryKeywords, nextProps.refiners, [], 1);\r\n\r\n                this.setState({\r\n                    results: searchResults,\r\n                    availableFilters: searchResults.RefinementResults,\r\n                    areResultsLoading: false,\r\n                });\r\n\r\n            } catch (error) {\r\n\r\n                Logger.write(\"[SearchContainer._componentWillReceiveProps()]: Error: \" + error, LogLevel.Error);\r\n\r\n                this.setState({\r\n                    areResultsLoading: false,\r\n                    isComponentLoading: false,\r\n                    results: { RefinementResults: [], RelevantResults: [] },\r\n                    hasError: true,\r\n                    errorMessage: error.message\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Callback function to apply new filters coming from the filter panel child component\r\n     * @param newFilters The new filters to apply\r\n     */\r\n    private async _onUpdateFilters(newFilters: IRefinementFilter[]) {\r\n\r\n        // Get back to the first page when new filters have been selected\r\n        this.setState({\r\n            selectedFilters: newFilters,\r\n            currentPage: 1,\r\n            areResultsLoading: true,\r\n        });\r\n\r\n        const searchResults = await this.props.searchDataProvider.search(this.props.queryKeywords, this.props.refiners, newFilters, 1);\r\n\r\n        this.setState({\r\n            results: searchResults,\r\n            areResultsLoading: false,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Callback function update search results according the page number\r\n     * @param pageNumber The page mumber to get\r\n     */\r\n    private async _onPageUpdate(pageNumber: number) {\r\n\r\n        this.setState({\r\n            currentPage: pageNumber,\r\n            areResultsLoading: true,\r\n        });\r\n\r\n        const searchResults = await this.props.searchDataProvider.search(this.props.queryKeywords, this.props.refiners, this.state.selectedFilters, pageNumber);\r\n\r\n        this.setState({\r\n            results: searchResults,\r\n            areResultsLoading: false,\r\n        });\r\n    }\r\n}"],"sourceRoot":"..\\..\\..\\..\\..\\src"}